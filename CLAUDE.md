# Claude Code Guide - Legacy Refactoring Project

## 프로젝트 개요
- **목적**: 1년 된 레거시(React + Spring Boot) 프로젝트의 가독성 중심 리팩토링
- **핵심 가치**: 켄트 백의 'Clean Code' 철학 준수 (가독성 > 성능)

---

## 코딩 가이드라인 (중요)

1. **함수/메서드 길이 제한**: 모든 함수와 메서드는 주석을 제외하고 **최대 20줄**을 넘지 않아야 한다.
2. **Composed Method 패턴**: 하나의 함수는 동일한 추상화 수준의 단계들로 구성하며, 세부 로직은 의도가 드러나는 이름의 작은 함수로 추출한다.
3. **가독성 우선**: 현재 단계에서는 성능 최적화를 위해 가독성을 희생하지 않는다. 성능 관련 지적 사항은 코드로 구현하지 말고 `PERFORMANCE_HYPOTHESIS.md`에 기록만 한다.
4. **테스트 우선**: 리팩토링 수행 전, 현재 기능을 보장하는 최소한의 테스트 코드가 있는지 확인하고 없다면 작성부터 제안한다.
5. **의존성 무결성**: 사용자의 승인 없이 새로운 라이브러리를 설치하거나 시스템 환경 설정을 변경하지 않는다.
6. **명확한 명명**: 20줄 제한을 지키기 위해 의미가 불분명한 변수명을 사용하지 않으며, 모든 매직 넘버는 상수로 추출한다.

---

## 기술 스택별 규칙

### Backend (Spring Boot)
- Service 레이어에 비즈니스 로직 집중
- 생성자 주입(Lombok `@RequiredArgsConstructor`) 사용

### Frontend (React)
- 비대한 컴포넌트는 Custom Hooks로 로직 분리
- 컴포넌트 파일 하나당 하나의 컴포넌트 원칙 준수

---

## 작업 워크플로우

1. 모든 작업 시작 전 `plans/plan-xx-[description].md`를 생성하여 승인을 받은 후 코딩을 시작한다.
2. **작업 항목 완료 시 `plans/plan-xx.md`에 체크(`[x]`)를 표시**하여 진행도를 추적한다.
3. **Plan 완료 시 상태를 `✅ 완료`로 업데이트**하고 완료일을 기록한다.
4. **Phase 또는 주요 마일스톤 완료 시 `ROADMAP.md`를 업데이트**한다.
5. 작업 완료 후 `HISTORY.md`를 업데이트한다.
6. **커밋 전 `.gitignore` 파일을 확인**하여 민감 파일(`.env`, `gcp-key.json` 등)이 staging에 포함되지 않도록 한다.
7. **`CLAUDE.md` 수정 시 즉시 커밋 & 푸시**한다. (프로젝트 가이드라인 변경은 즉시 반영)
8. **큰 단위 작업 완료 시 커밋 & 푸시**를 수행한다.

### 커밋 전 체크리스트
- [ ] `.gitignore`에 명시된 파일이 staging에 없는지 확인 (`git status`)
- [ ] 민감 정보(API 키, 비밀번호, 인증서)가 커밋에 포함되지 않는지 확인

### 장시간 명령 처리 규칙
- 명령 실행 상태 확인이 **3회 이상 반복**될 경우, 사용자에게 알리고 계속 진행할지 확인한다.
- Gradle/npm 등 빌드 도구는 `--no-daemon` 옵션을 우선 사용하여 데몬 시작 지연을 방지한다.
- 명령이 응답 없이 **5분 이상** 대기 중이면 중단하고 사용자에게 보고한다.
- **시스템 에러 발생 시 즉시 작업을 중단**하고 사용자에게 알린다.

### Git Commit Convention (Angular Style)

```
<type>(<scope>): <subject>

<body>

<footer>
```

| Type | 설명 |
|------|------|
| `feat` | 새로운 기능 추가 |
| `fix` | 버그 수정 |
| `refactor` | 코드 리팩토링 (기능 변경 없음) |
| `test` | 테스트 추가/수정 |
| `docs` | 문서 수정 |
| `style` | 코드 포맷팅, 세미콜론 누락 등 |
| `chore` | 빌드 설정, 패키지 매니저 설정 등 |

**예시**:
```
refactor(auth): JWTFilter 메서드 20줄 이하로 분할

- extractToken(), validateToken(), buildAuthContext() 추출
- Composed Method 패턴 적용

Refs: plan-02
```

---

## 프로젝트 문서 관리 규칙

| 문서 | 목적 | 업데이트 시점 |
|------|------|---------------|
| `ROADMAP.md` | 전체 리팩토링 마일스톤 관리 | 기획자 승인 하에 업데이트 |
| `plans/plan-xx-[description].md` | 개별 단위 작업의 상세 설계도 | 작업 전 작성 |
| `HISTORY.md` | 모든 작업 과정의 타임라인 로그 | 작업 직후 자동 기록 |
| `SUMMARY.md` | 각 Phase 종료 시 성과 요약 | 결과 보고용 |
| `ADR.md` | 프로젝트 전반에 영향을 주는 중대한 아키텍처 결정 | 중대 결정 시 |

### HISTORY.md 기록 항목
- `[Timestamp]`: 작업 시점
- `[Command]`: 실행한 명령/작업
- `[Files]`: 영향받은 파일 목록
- `[Rationale/Decision]`: 결정 근거

---

## 에러 처리 및 트러블슈팅 (Boris Cherny 스타일)

1. **에러 로그 기록**: 컴파일 에러, 테스트 실패, 런타임 예외 발생 시 해당 에러 메시지와 원인을 분석하여 즉시 `HISTORY.md`에 기록한다.
2. **복구 절차**: 에러 해결을 위해 시도한 방법(명령어, 코드 수정)을 순차적으로 기록하여, 동일 에러 발생 시 재현 및 해결 근거로 삼는다.
3. **가설 기반 해결**: 막연한 수정 대신 "A를 수정하면 B 에러가 해결될 것이다"라는 가설을 세우고 실행한다.
4. **실증적 검증**: 모든 수정 사항은 추측이 아닌 실제 컴파일 및 테스트 실행 결과를 바탕으로 검증되어야 한다.

---

## 컨텍스트 복구 및 세션 관리 (에이전트 최적화)

1. **세션 재개 규칙**: 새로운 세션이 시작되거나 작업이 일시 중단 후 재개될 때, 반드시 `ROADMAP.md`와 최근 3개의 `HISTORY.md` 항목을 읽어 현재 진행 상황을 동기화한다.
2. **중간 저장**: 복잡한 리팩토링 작업 중에는 `plans/plan-xx.md`에 현재까지 완료된 체크포인트를 체크표시(`[x]`)하여 진행도를 명시한다.

---

## 추가 코딩 원칙 (Kent Beck 스타일)

1. **테스트 없이 수정 금지**: 기존 코드를 수정하기 전, 해당 로직을 검증하는 테스트가 없다면 반드시 테스트부터 작성한다. (Red-Green-Refactor 사이클 준수)
2. **원자적 변경 (Atomic Changes)**: 한 번의 `HISTORY.md` 기록 당 하나의 논리적 단위만 수정한다. 여러 기능을 동시에 리팩토링하지 않는다.
